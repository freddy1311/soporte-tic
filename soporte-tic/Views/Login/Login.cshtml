@{
    ViewBag.Title = "Login";
    Layout = null;
}

<!doctype html>
<html lang="en">
<head>
    @await Html.PartialAsync("~/Views/Shared/_title_meta.cshtml")
    @await Html.PartialAsync("~/Views/Shared/_head_css.cshtml")
</head>

<body>
    <style>
        [v-cloak] {
            display: none;
        }

    </style>

    <div class="account-pages" id="page-login">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="text-center mb-5">
                        <a href="/" class="auth-logo">
                            <img src="~/assets/images/logo_dworkers_black.png" alt="Logo Dark" height="48" class="auth-logo-dark">
                            <img src="~/assets/images/logo_dworkers_white.png" alt="Logo Light" height="48" class="auth-logo-light">
                        </a>
                        <p class="font-size-15 text-muted mt-3">Sistema de <b>Gestión y Control</b> de Soporte</p>
                    </div>
                    <div class="card overflow-hidden ">
                        <div class="row g-0 justify-content-center">
                            <div class="col-lg-6 col-md-8">
                                <div class="p-lg-5 p-4">

                                    <div>
                                        <h5>Bienvenido !</h5>
                                        <p class="text-muted">Inicie sesión para ingresar.</p>
                                    </div>

                                    <!--Alerts-->
                                    <div class="alert alert-danger alert-dismissible fade show" v-if="(msgError != '')" v-cloak>
                                        <i class="mdi mdi-block-helper me-2"></i>
                                        {{msgError}}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                    <!--End Alerts-->

                                    <div class="mt-4 pt-3">
                                        <form id="frm-login">

                                            <div class="mb-3">
                                                <label for="email" class="fw-semibold">Email</label>
                                                <input type="email" class="form-control" name="Email" id="email" placeholder="Ingrese un email..." @@blur="checkEmail()" v-model="formData.email">
                                            </div>

                                            <div class="mb-3 mb-4">
                                                <label for="pass" class="fw-semibold">Password</label>
                                                <input type="password" class="form-control" name="Password" id="password" placeholder="Ingrese el password..." @@blur="checkPass()" v-model="formData.password">
                                            </div>

                                            <div class="row align-items-center">
                                                <div class="col-6">
                                                    @* <div class="form-check">
                                                            <input type="checkbox" class="form-check-input font-size-16" id="remember-check">
                                                            <label class="form-check-label" for="remember-check">Recordar sesión</label>
                                                        </div> *@
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-end">
                                                        <button class="btn btn-primary w-md waves-effect waves-light" type="button" v-on:click="loginUser()">
                                                            Ingresar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-4">
                                                <a href="auth-recoverpw.html" class="text-muted"><i class="mdi mdi-lock me-1"></i> Olvidó su contraseña?</a>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>


                        </div>
                    </div>
                    <!-- end card -->
                    <div class="mt-5 text-center">
                        <p>© {{currentYear}} <b>Soporte TIC</b>.</p>
                    </div>
                </div>
                <!-- end col -->
            </div>
            <!-- end row -->
        </div>
        <!-- end container -->
    </div>
    <!-- end account page -->
    @await Html.PartialAsync("~/Views/Shared/_vendor_scripts.cshtml")

    <script src="~/assets/js/pages/pass-addon.init.js"></script>

    <script>

        var appLogin = new Vue({
            el: '#page-login',
            data: {
                msgTest: 'Bienvenido a Soporte TIC',
                msgError: '',
                msgSuccess: '',
                formData: {
                    email: '',
                    password: ''
                },
                currentYear: null,
                isValidForm: false
            },
            mounted: function () {
                this.msgError = '';
                this.msgSuccess = '';
            },
            created: function () {
                this.currentYear = new Date().getFullYear();
            },
            methods: {
                blockUI: function (msg) {
                    $(function () {
                        //#region block UI
                        $('#page-login').block({
                            message: msg,
                            css: {
                                backgroundColor: '#36404a',
                                color: '#fff',
                                height: 40,
                                paddingTop: 10,
                                paddingLeft: 10,
                                paddingRight: 10,
                                borderRadius: 7,
                                border: '0',
                                opacity: 0.5,
                                zIndex: 9999999,
                                cursor: 'wait'
                            },
                        });
                        //#endregion
                    });
                },
                unblockUI: function () {
                    $(function () {
                        $('#page-login').unblock();
                    });
                },
                showAlert: function (title, msg, icon) {

                    const typeIcon = icon;

                    Swal.fire(
                        {
                            title: title,
                            text: msg,
                            icon: typeIcon,
                            confirmButtonColor: '#0576b9'
                        }
                    );
                },
                checkEmail: function () {
                    if (this.formData.email !== '') {
                        $('#email').removeClass('is-invalid');
                        this.isValidForm = true;
                    } else {
                        $('#email').addClass('is-invalid');
                        this.isValidForm = false;
                    }
                },
                checkPass: function () {
                    if (this.formData.pass !== '') {
                        $('#pass').removeClass('is-invalid');
                        this.isValidForm = true;
                    } else {
                        $('#pass').addClass('is-invalid');
                        this.isValidForm = false;
                    }
                },
                loginUser: function () {
                    const url = '/Login/Login/';

                    this.msgError = '';
                    this.msgSuccess = '';

                    if (!this.isValidForm) {
                        this.showAlert('Validación', 'Por favor ingrese las credenciales!.', 'warning');
                        return;
                    }

                    this.blockUI('Iniciando sesión...');

                    axios.post(url, this.formData)
                        .then(response => {
                            console.log('Response loginUser => ' + response.data);

                            let rm = response.data;

                            if (rm.response) {
                                this.msgSuccess = rm.message;
                                this.msgError = '';

                                window.location.href = '/Home/Index';
                            } else {
                                this.msgSuccess = '';
                                this.msgError = rm.message;
                            }

                            this.unblockUI();

                        })
                        .catch(error => {
                            console.error('Error loginUser => ' + error);
                            this.unblockUI();
                        });
                }
            }
        });
    </script>

</body>
</html>